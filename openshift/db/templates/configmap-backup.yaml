apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Values.app.name }}-backup
  namespace: {{ .Values.backup.namespace }}
data:
  ENVIRONMENT: "{{ .Values.environment }}"
  BACKUP_STRATEGY: "{{ .Values.backup.strategy }}"
  BACKUP_DIR: "{{ .Values.backup.mountPath }}"
  NUM_BACKUPS: "40"
  DAILY_BACKUPS: "7"
  WEEKLY_BACKUPS: "4"
  MONTHLY_BACKUPS: "3"
  TABLE_SCHEMA: "{{ .Values.backup.schema }}"
  ENVIRONMENT_NAME: "{{ .Values.backup.environment }}"
  ENVIRONMENT_FRIENDLY_NAME: "{{ .Values.backup.environmentFriendlyName }}"
  CONTAINER_TYPE: "postgres"
  POSTGRESQL_DATABASE: "{{ .Values.backup.databaseName }}"
  # Verification-specific credentials to avoid postgres superuser conflict
  # Corresponds to virtual "verify" connection spec in backup.conf
  VERIFY_USER: "verify_user"
  VERIFY_PASSWORD: "verify_pass_temp"
  
  backup.conf: |
{{ .Files.Get "files/backup.conf" | indent 4 }}


  emergency-restore.sh: |
{{ .Files.Get "files/emergency-restore.sh" | indent 4 }}