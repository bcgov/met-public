# Default values for Locust helm chart

# Application metadata
app:
  name: locust
  licenseplate: e903c2

# Vault configuration for route protection
vault:
  namespace: "platform-services"
  authPath: "auth/k8s-gold"

# Locust main configuration
main:
  name: locust-main
  replicas: 1
  image:
    repository: locustio/locust
    tag: 2.43.1
    pullPolicy: IfNotPresent

  resources:
    requests:
      cpu: 100m
      memory: 256Mi
      "ephemeral-storage": "1Gi"
    limits:
      cpu: 500m
      memory: 512Mi
      "ephemeral-storage": "2Gi"

  config:
    # Target host to load test
    targetHost: "" # Overridden in environment-specific values files
    # Path to locustfile
    locustFile: /mnt/locust/locustfile.py

  service:
    type: ClusterIP
    webPort: 8089
    mainPort: 5557
    workerPort: 5558

# Locust worker configuration
worker:
  name: locust-worker
  replicas: 2
  image:
    repository: locustio/locust
    tag: 2.43.1
    pullPolicy: IfNotPresent

  resources:
    requests:
      cpu: 200m
      memory: 256Mi
      ephemeral-storage: 1Gi
    limits:
      cpu: 1000m
      memory: 512Mi
      ephemeral-storage: 2Gi

# Route configuration
route:
  enabled: true
  host: "" # Will be auto-generated by OpenShift if empty
  annotations: {}
  tls:
    enabled: true
    termination: edge
    insecureEdgeTerminationPolicy: Redirect
  # IP restrictions for route access
  ipRestrictions:
    enabled: true

# NetworkPolicy configuration
networkPolicy:
  enabled: true
  allowInternet: true

# Namespace
namespace: e903c2-dev

# ConfigMap for locustfile
locustfile:
  enabled: true
  # Default locustfile content
  # This example tests both the web frontend and API
  content: |
    from locust import HttpUser, task, between
    import random

    class METWebUser(HttpUser):
        """
        Simulates a user interacting with the web frontend
        """
        wait_time = between(1, 5)
        
        @task(5)
        def load_homepage(self):
            """Load the main homepage"""
            self.client.get("/")
        
        @task(10)
        def browse_engagements(self):
            """Browse engagements list (most common action)"""
            self.client.get("/engagements")
        
        @task(3)
        def view_engagement(self):
            """View a specific engagement"""
            engagement_id = random.randint(1, 10)
            self.client.get(f"/engagements/{engagement_id}/view")

    class METApiUser(HttpUser):
        """
        Simulates API client making direct API calls
        Tests the /api endpoint directly
        """
        wait_time = between(1, 3)
        
        @task(5)
        def get_engagements_api(self):
            """Get engagements via API"""
            self.client.get("/api/engagements")
        
        @task(3)
        def get_surveys_api(self):
            """Get surveys via API"""
            self.client.get("/api/surveys")
        
        @task(2)
        def get_metadata_api(self):
            """Get metadata via API"""
            self.client.get("/api/metadata")
        
        @task(1)
        def get_tenant_info_api(self):
            """Get tenant information via API"""
            self.client.get("/api/tenants")
